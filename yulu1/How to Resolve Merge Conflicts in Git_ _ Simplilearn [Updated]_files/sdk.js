(()=>{"use strict";var t={379:()=>{let t=[],e={},s={},n=0;const i=t=>{var e=t.getBoundingClientRect();return e.bottom>0&&e.right>0&&e.left<(window.innerWidth||document.documentElement.clientWidth)&&e.top<(window.innerHeight||document.documentElement.clientHeight)};function o(){t.forEach((t=>{const n=i(e[t]);if(n!==s[t]){s[t]=n;const i={eventName:"INFO",data:{isInViewport:s[t]}};e[t].contentWindow.postMessage(i,"*")}}))}const a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};window.addEventListener("message",(function(o){const a=o.data,r=o.source;if(a&&"INIT"===a.eventName){n+=1,o.stopPropagation();const l=document.querySelectorAll("iframe");for(let o=0;o<l.length;o++)if(l[o].contentWindow===r){l[o].style.height=a.data.height,l[o].style.setProperty&&l[o].style.setProperty("height",a.data.height,"important"),l[o].height=a.data.height,l[o].style.overflow="hidden",t.push(n),e[n]=l[o];const c={eventName:"INIT_ACK",data:{id:n}};r.postMessage(c,"*"),s[n]=i(l[o]);const d={eventName:"INFO",data:{isInViewport:s[n]}};r.postMessage(d,"*")}}else"DIMENSIONS_UPDATE"===a.eventName&&(e[a.data.id].style.height=a.data.height,e[a.data.id].style.setProperty&&e[a.data.id].style.setProperty("height",a.data.height,"important"),e[a.data.id].height=a.data.height)})),document.addEventListener("scroll",(()=>a(o)),{passive:!0})}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,s),o.exports}(()=>{var t=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function r(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))};function e(e){return t(this,void 0,void 0,(function*(){return new Promise(((s,n)=>t(this,void 0,void 0,(function*(){const t=e.method,i=e.url,o=e.headers.get("authorization");let a=null;try{a=yield e.text()}catch(t){console.log(t)}let r=new XMLHttpRequest;r.open(t,i),r.setRequestHeader("Content-Type","application/json"),r.responseType="json",o&&r.setRequestHeader("authorization",o),a?r.send(a):r.send(),r.onload=function(){if(200!=r.status)throw n("API Error"),"API Error";s(Object.assign(Object.assign({},r.response),{parsedBody:r.response}))},r.onerror=function(){throw n("Network Error"),"Network Error"}}))))}))}function n(s,n,i){return t(this,void 0,void 0,(function*(){const t={method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}};return i&&(t.headers.authorization=`Bearer ${i}`),yield e(new Request(s,t))}))}function i(s,n){return t(this,void 0,void 0,(function*(){const t={method:"get",headers:{"Content-Type":"application/json"}};return n&&(t.headers.authorization=`Bearer ${n}`),yield e(new Request(s,t))}))}function o(t){return"BOTTOM_SHEET"===t.typeId?{typeId:"BOTTOM_SHEET",css:t.css,height:t.height}:"CHAT_BOX"===t.typeId?{typeId:"CHAT_BOX",css:t.css}:"EMBEDDED"===t.typeId?{typeId:"EMBEDDED",css:t.css,elementHookId:t.elementId}:"LAUNCHER_ICON"===t.typeId?{typeId:"ICON_BUTTON",css:t.css}:"POP_UP"===t.typeId?{typeId:"POP_UP",css:t.typeId}:void 0}function a(t){const e=t[0];return"CAMPAIGN"===e.typeId?{typeId:"CAMPAIGN",conditions:Object.assign(Object.assign({},e.conditions),{campaignId:e.campaignId})}:"STATIC"===e.typeId?{typeId:"STATIC",src:e.src,action:e.action}:"WALLET"===e.typeId?{typeId:"WALLET"}:void 0}var r=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function r(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))};const l="https://api.customerglu.com",c=(t,e,s,i)=>r(void 0,void 0,void 0,(function*(){try{return(yield n(`${l}/user/v1/user/sdk?token=true`,Object.assign(Object.assign({writeKey:t,userId:e},s.gluAttributes),{customAttributes:s.customAttributes}))).parsedBody.data.token}catch(n){let o=i;if(i||(o=0),o<5)return yield c(t,e,s,++o);throw n}})),d=(t,e)=>r(void 0,void 0,void 0,(function*(){try{return yield i(`${l}/reward/v1.1/user`,t)}catch(s){let n=e;if(e||(n=0),n<5)return yield d(t,++n);throw s}})),h=(t,e,s,i)=>r(void 0,void 0,void 0,(function*(){let o="https://api.customerglu.com/reward/v1.1/user/reward";e?o=o+"?campaignId="+e:s&&(o=o+"?rewardUserId="+s);try{const e=(yield n(o,{},t)).parsedBody;if(!e||!e.success||!e.data)throw`Invalid Response, ${e&&e.message?"cause: "+e.message:null}`;return e.data.rewards}catch(n){let o=i;if(i||(o=0),o<5)return yield h(t,e,s,++o);throw n}}));function u(t){!function(t){r(this,void 0,void 0,(function*(){try{yield fetch("https://stream.customerglu.com/v3/analytics",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-API-KEY":"z","X-GLU-AUTH":`Bearer ${window.GluToken}`}})}catch(t){}}))}({timestamp:new Date,event_name:"sdk_error_interaction",event_properties:t})}function p(t,e){for(let s=0;s<e.length;s++)if(m(t,e[s]))return!0;return!1}function m(t,e){if(t.endsWith("/")&&(t=t.slice(0,t.length-1)),e.endsWith("/")&&(e=e.slice(0,e.length-1)),e.startsWith("http")||(e=location.protocol+"//"+e),e.endsWith("/*")){if(e=e.slice(0,e.length-2),t.startsWith(e))return!0}else if(e===t)return!0;return!1}function _(t){const e=t.split("/");return e[0]+"//"+e[2]}function f(){return"__GLU__"+((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>t+((e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_")),""))()}s(379);const g={iframe:{className:"__GLU__IFRAME",css:".__GLU__IFRAME{ height: 100%; width: 100%; border: none !important; outline: none; }"},hideScroll:{className:"__GLU_HIDE_SCROLL",css:".__GLU_HIDE_SCROLL::-moz-focus-inner {border: 0;} .__GLU_HIDE_SCROLL::-webkit-scrollbar {width: 0px !important;background: transparent !important;display: none !important;} .__GLU_HIDE_SCROLL {scrollbar-width: none !important;-ms-overflow-style: -ms-autohiding-scrollbar !important;}"},slideUp:{className:"__GLU__SLIDE_UP",css:".__GLU__SLIDE_UP { animation: GLU_SLIDE_UP 300ms ease-out; }  @keyframes GLU_SLIDE_UP { from { opacity: 0; transform: translateY(100px); }to { opacity: 1; transform: translateY(0px); }}"},slideDown:{className:"__GLU__SLIDE_DOWN",css:".__GLU__SLIDE_DOWN { animation: GLU_SLIDE_DOWN 300ms ease-out; }  @keyframes GLU_SLIDE_DOWN { from { opacity: 1; transform: translateY(0px); }to { opacity: 0; transform: translateY(100px); }}"},slideUpSheet:{className:"__GLU__SLIDE_UP_SHEET",css:".__GLU__SLIDE_UP_SHEET { animation: GLU_SLIDE_UP_SHEET 300ms ease-out; }  @keyframes GLU_SLIDE_UP_SHEET { from { transform: translateY(100%); } to { transform: translateY(0px); }}"},slideDownSheet:{className:"__GLU__SLIDE_DOWN_SHEET",css:".__GLU__SLIDE_DOWN_SHEET { animation: GLU_SLIDE_DOWN_SHEET 300ms ease-out forwards; }  @keyframes GLU_SLIDE_DOWN_SHEET { from { transform: translateY(0px); } to { transform: translateY(100%); }}"},iconButton:{className:"__GLU__ICON_BUTTON",css:".__GLU__ICON_BUTTON { position: fixed; bottom: 40px; left: 40px; height: 160px; width: 160px; overflow: hidden;  z-index: 999;}"},chatBox:{className:"__GLU__CHAT_BOX",css:".__GLU__CHAT_BOX { position: fixed; bottom: 220px; left: 40px; height: 580px; width: 360px; background-color: #fff; border-radius: 24px; overflow-x: hidden;  z-index: 9999; }"},popUp:{className:"__GLU__POP_UP",css:".__GLU__POP_UP { max-height: 740px; max-width: 1000px; width: 100%; height:100%; background-color: #fff; border-radius: 12px; z-index: 999999; overflow: hidden;}"},backDrop:{className:"__GLU__BACK_DROP",css:".__GLU__BACK_DROP { position: fixed; bottom: 0px; left: 0px; height: 100vh; width: 100vw; background-color: rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center;  z-index: 99999;}"},bottomSheet:{className:"__GLU__BOTTOM_SHEET",css:".__GLU__BOTTOM_SHEET { height: 880px; width: 600px; max-width: 100%; max-height: 100%; background-color: #fff; border-radius: 20px 20px 0px 0px; overflow-x: hidden; z-index: 999999; align-self: flex-end}"},embedded:{className:"__GLU__EMBEDDED",css:".__GLU__EMBEDDED {  width: 100%; overflow-x: hidden; }"}};function E(t,e,s){return t?t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s):""}class y{constructor(t,e){this.rootElement=null,this.isShown=!1,this.container=t,this.contentElement=e,y.DEFAULT_STYLE_ADDED||(this.mountStyle(function(){let t="";for(let e in g)t+=g[e].css;return t}()),y.DEFAULT_STYLE_ADDED=!0)}mountStyle(t){const e=document.createElement("style");e.innerHTML=t,y.HEAD.appendChild(e)}addCustomStyle(t){if(this.container.css){const e=function(t,e){let s=t;for(const n in e)t.includes(n)&&(s=E(s,n,e[n]));return s}(this.container.css,t);this.mountStyle(e)}}hide(){this.isShown=!1,y.BODY.removeChild(this.rootElement)}show(){y.BODY.appendChild(this.rootElement),this.isShown=!0}addCloseListener(t){this.closeListener=t}}y.HEAD=document.querySelector("head"),y.BODY=document.querySelector("body"),y.DEFAULT_STYLE_ADDED=!1;class I extends y{constructor(t,e){super(t,e),this.embedClassName=f(),this.hook=null,this.createElement(),this.hook=document.querySelector(t.elementHookId),this.addCustomStyle({__glu_container:this.embedClassName})}createElement(){const t=document.createElement("div");t.appendChild(this.contentElement),t.classList.add(this.embedClassName,g.embedded.className),this.rootElement=t}hide(){this.contentElement.remove()}show(){this.hook.append(this.rootElement)}}class w extends y{constructor(t,e){super(t,e),this.iconButtonClassName=f(),this.createElement(),this.addCustomStyle({__glu_container:this.iconButtonClassName})}createElement(){const t=document.createElement("div");t.appendChild(this.contentElement),t.classList.add(g.iconButton.className,this.iconButtonClassName),this.rootElement=t}hide(){this.rootElement.classList.remove(g.slideUp.className),this.rootElement.classList.add(g.slideDown.className),super.hide()}show(){this.rootElement.classList.remove(g.slideDown.className),this.rootElement.classList.add(g.slideUp.className),super.show()}}class L extends y{constructor(t,e){super(t,e),this.chatBoxClassName=f(),this.createElement(),this.addCustomStyle({__glu_container:this.chatBoxClassName})}createElement(){const t=document.createElement("div");t.appendChild(this.contentElement),t.classList.add(g.chatBox.className,this.chatBoxClassName),this.rootElement=t,this.rootElement.addEventListener("animationend",(()=>{this.isShown||super.hide()}))}hide(){this.rootElement.classList.remove(g.slideUp.className),this.rootElement.classList.add(g.slideDown.className),this.isShown=!1}show(){this.rootElement.classList.remove(g.slideDown.className),this.rootElement.classList.add(g.slideUp.className),this.isShown=!0,super.show()}}class N extends y{constructor(t,e){super(t,e),this.popupClassName=f(),this.backDropClassName=f(),this.popupElement=null,this.createElement(),this.addCustomStyle({__glu_container:this.popupClassName,__glu_backdrop:this.backDropClassName})}createElement(){const t=document.createElement("div");t.classList.add(this.backDropClassName,g.backDrop.className);const e=document.createElement("div");e.classList.add(this.popupClassName,g.popUp.className,g.hideScroll.className),e.appendChild(this.contentElement),t.appendChild(e),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.closeListener&&this.closeListener()})),this.rootElement=t,this.popupElement=e,this.rootElement.addEventListener("animationend",(()=>{this.isShown||super.hide()}))}hide(){this.popupElement.classList.remove(g.slideUp.className),this.popupElement.classList.add(g.slideDown.className),this.isShown=!1}show(){this.popupElement.classList.remove(g.slideDown.className),this.popupElement.classList.add(g.slideUp.className),this.isShown=!0,super.show()}}class C extends y{constructor(t,e){super(t,e),this.sheetClassName=f(),this.backDropClassName=f(),this.sheetElement=null,this.height=t.height,this.createElement(),this.addCustomStyle({__glu_container:this.sheetClassName,__glu_backdrop:this.backDropClassName})}createElement(){const t=document.createElement("div");t.classList.add(this.backDropClassName,g.backDrop.className);const e=document.createElement("div");e.appendChild(this.contentElement),e.classList.add(this.sheetClassName,g.bottomSheet.className,g.hideScroll.className),e.style.height=this.height,t.appendChild(e),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.closeListener&&this.closeListener()})),this.rootElement=t,this.sheetElement=e,this.rootElement.addEventListener("animationend",(()=>{this.isShown||super.hide()}))}hide(){this.sheetElement.classList.remove(g.slideUpSheet.className),this.sheetElement.classList.add(g.slideDownSheet.className),this.isShown=!1}show(){this.sheetElement.classList.remove(g.slideDownSheet.className),this.sheetElement.classList.add(g.slideUpSheet.className),this.isShown=!0,super.show()}}class v{constructor(t){this.messageListener=(t,e)=>{const s=e;if(s&&s.action&&"CLOSE_FRAME_CONTENT"===s.action.type&&(e.action.type="CLOSE_CONTAINER_CONTENT"),this.element instanceof HTMLIFrameElement&&t===this.element.contentWindow)this.sdkEventListener&&this.sdkEventListener(e);else if("UPDATE_CONTENT_STATE"===e.action.type)this.sendMessageToContent(e.action);else if("CLOSE_CONTAINER_CONTENT"===e.action.type){const t={target:"GLU_SDK",action:{type:"UPDATE_CONTENT_STATE",data:e.action.data}};this.sendMessageToContent(t.action)}},this.config=t,v.LISTENERS.push(this.messageListener),v.IS_LISTENING||(window.addEventListener("message",(t=>{let e=t.data;if("string"==typeof e&&(e=JSON.parse(e),"ANALYTICS"===e.eventName)){let t={target:"GLU_SDK",action:{type:"ANALYTICS",data:e.data}};e=t}"GLU_SDK"===e.target&&(v.LISTENERS.forEach((s=>s(t.source,e))),t.stopPropagation(),t.preventDefault())})),v.IS_LISTENING=!0)}urlModifier(t,e){let s=t.includes("?")?"&":"?";return s+=s+"source=JS_SDK",e&&e.token&&(s+=`&token=${this.config.token}`),this.config.isEmbedded&&(s+="&embed=true"),this.config.user.userId||(s+="&notLoggedIn=true"),t+s}listen(t){this.sdkEventListener=t}sendMessageToContent(t){const e={target:"GLU_SDK",action:t};this.element instanceof HTMLIFrameElement&&(this.element&&this.element.contentWindow&&this.element.contentWindow.postMessage?this.element.contentWindow.postMessage(e,"*"):console.log("contentWindow not found:",this.config))}}v.LISTENERS=[],v.IS_LISTENING=!1;class S extends v{constructor(t,e){super(e),this.content=t;const s=this.getUrl();this.create(s)}create(t){let e=document.createElement("iframe");e.classList.add(g.iframe.className),e.style.height="100%",e.style.width="100%",e.style.display="block",e.src=this.urlModifier(t),this.element=e}getUrl(){const t=this.config.allCampaignsMap,e=this.content.conditions,s=Object.keys(e);if(0===s.length)throw new Error("no conditions present");if(s.length){for(let n=0;n<t.allIds.length;n++){const i=t.allIds[n],o=t.byId[i];let a=!0;for(let t=0;t<s.length;t++){const n=s[t];if("string"==typeof e[n]&&e[n]!==o[n]&&o.banner[n]!==e[n]){a=!1;break}if(!e[n].includes(o[n])&&!e[n].includes(o.banner[n])){a=!1;break}}if(a)return o.url}throw new Error("CAMPAIGN_NOT_FLOUND")}}}class T extends v{constructor(t,e){super(e),this.content=t;const s=this.getUrl();this.create(s)}create(t){let e=document.createElement("iframe");e.classList.add(g.iframe.className),e.style.height="100%",e.style.width="100%",e.style.display="block",e.src=t,this.element=e}getUrl(){let t=this.config.allCampaignsMap.base+"/program/?campaignId="+this.content.campaignId;return this.urlModifier(t,{token:!0})}}class b extends v{constructor(t,e){super(e),this.content=t;const s=this.getUrl();this.create(s)}create(t){let e=document.createElement("iframe");e.classList.add(g.iframe.className),e.style.height="100%",e.style.width="100%",e.style.display="block",e.src=t,this.element=e}getUrl(){let t=this.config.allCampaignsMap.base+"/reward/?rewardUserId="+this.content.rewardUserId;return this.urlModifier(t,{token:!0})}}class D extends v{constructor(t,e){super(e),this.actionId=f(),this.data=t,this.create()}create(){let t=document.createElement("img");t.style.maxWidth="100%",t.style.maxHeight="100%",t.style.display="block",t.style.cursor="pointer",t.src=this.data.src,t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault();let e=this.data.action;if(!e)return null;"TOGGLE_CONTAINER_CONTENT"===e.type&&"object"==typeof e&&(e=Object.assign(Object.assign({},e),{id:this.actionId}));const s={target:"GLU_SDK",action:e};this.sdkEventListener(s)})),this.element=t}}class O extends v{constructor(t,e){super(e),this.content=t,this.create()}create(){let t=document.createElement("iframe");t.classList.add(g.iframe.className),t.style.height="100%",t.style.width="100%",t.style.display="block",t.src=this.urlModifier(this.config.allCampaignsMap.defaultUrl),this.element=t}}class U{constructor(t,e){this.entryPoint=t,this.config=e,this.initilizeContent(),this.initilizeContainer()}initilizeContainer(){const t=this.entryPoint.container;if("BOTTOM_SHEET"===t.typeId)this.container=new C(t,this.content.element);else if("CHAT_BOX"===t.typeId)this.container=new L(t,this.content.element);else if("EMBEDDED"===t.typeId)this.container=new I(t,this.content.element);else if("ICON_BUTTON"===t.typeId)this.container=new w(t,this.content.element);else{if("POP_UP"!==t.typeId)throw new Error("CONTENT_NOT_FOUND");this.container=new N(t,this.content.element)}this.container.addCloseListener((()=>this.containerCloseEventListener()))}initilizeContent(){const t=this.entryPoint.content,e={user:this.config.userIdentification,token:this.config.token,allCampaignsMap:this.config.allCampaignsMap,isEmbedded:"EMBEDDED"===this.entryPoint.container.typeId};if("CAMPAIGN"===t.typeId)this.content=new S(t,e);else if("PROGRAM"===t.typeId)this.content=new T(t,e);else if("REWARD"===t.typeId)this.content=new b(t,e);else if("STATIC"===t.typeId)this.content=new D(t,e);else{if("WALLET"!==t.typeId)throw new Error("CONTENT_TYPE_NOT_FOUND");this.content=new O(t,e)}this.content.listen((t=>this.contentEventListener(t)))}containerCloseEventListener(){this.closeEventListener&&this.closeEventListener()}contentEventListener(t){this.eventListener&&this.eventListener(t)}addEventListener(t){this.eventListener=t}addCloseEventListener(t){this.closeEventListener=t}checkConditions(){let t=!0;const e=this.entryPoint.conditions;if(!e)return!0;const{paths:s,showCount:n,timeWindow:i,isLoggedIn:o}=e,a=new Date,r=window.location.href;if(o&&!this.config.userIdentification.userId&&(t=!1),t&&i&&(a.valueOf()<i.start.valueOf()&&(t=!1),a.valueOf()>i.end.valueOf()&&(t=!1)),t&&s&&(s.excludePaths.length&&p(r,s.excludePaths)&&(t=!1),s.includePaths.length&&!p(r,s.includePaths)&&(t=!1)),t&&n){const{count:e,dailyRefresh:s}=n,i=JSON.parse(localStorage.getItem("__GLU__COUNT_DATE_"+this.entryPoint.id));if(s)if(i){const s=i.count;let n=new Date(i.date);if(a.getDate()===n.getDate())if(s>=e)t=!1;else{const t={count:s+1,date:a};localStorage.setItem("__GLU__COUNT_DATE_"+this.entryPoint.id,JSON.stringify(t))}else{const t={count:1,date:a};localStorage.setItem("__GLU__COUNT_DATE_"+this.entryPoint.id,JSON.stringify(t))}}else{const t={count:1,date:a};localStorage.setItem("__GLU__COUNT_DATE_"+this.entryPoint.id,JSON.stringify(t))}else if(i)i.count>=e&&(t=!1);else{const t={count:1,date:a};localStorage.setItem("__GLU__COUNT_DATE_"+this.entryPoint.id,JSON.stringify(t))}}return t}getConditions(){return this.entryPoint.conditions}open(){this.container&&this.container.show()}close(){this.container.hide()}isOpen(){return this.container.isShown}toggle(){this.isOpen()?this.close():this.open()}sendMessage(t){this.content.sendMessageToContent(t)}}function P(t,e,s){return n=this,i=void 0,a=function*(){const n=function(t,e){const s=Object.keys(t);if(0===s.length)throw new Error("no conditions present");if(s.length){for(let n=0;n<e.allIds.length;n++){const i=e.allIds[n],o=e.byId[i];let a=!0;for(let e=0;e<s.length;e++){const n=s[e];if("string"==typeof t[n]&&t[n]!==o[n]&&o.banner[n]!==t[n]){a=!1;break}if(!t[n].includes(o[n])&&!t[n].includes(o.banner[n])){a=!1;break}}if(a)return o}throw new Error("CAMPAIGN_NOT_FLOUND")}}(t,s),i={details:n};if(!e||!e.includeRewards)return i;const o=yield h(window.GluToken,n.campaignId),a=o.allIds.map((t=>function(t){var e;const s={game_name:t.experience,state:t.experienceConsumed?"complete":"pristine",campaign_id:t.campaignId,reward_user_id:t.rewardUserId,user_id:t.userId,status:t.status};if(t.experienceConsumed){const n=t.slots[t.selectedSlotIndex].reward;s.selected_slot_index=t.selectedSlotIndex,s.reward_type=n.type,s.reward_name=t.rewardProperties.title||"not_available",s.details=t.rewardProperties.details||"not_available",s.reward_amount=(null===(e=t.valueComponent)||void 0===e?void 0:e.value)||"not_available",s.code=t.rewardProperties.code||n.rewardProperties.code||"not_available"}return s}(o.byId[t])));return i.rewards=a,i},new((o=void 0)||(o=Promise))((function(t,e){function s(t){try{l(a.next(t))}catch(t){e(t)}}function r(t){try{l(a.throw(t))}catch(t){e(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(s,r)}l((a=a.apply(n,i||[])).next())}));var n,i,o,a}var A=function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function r(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))};window.CustomerGlu=class{constructor(t,e,s){if(this.writeKey=null,this.userIdentification=null,this.token=null,this.initilized=!1,this.allCampaignsMap={allIds:[],byId:{},defaultUrl:"",base:""},this.analyticsListener=null,this.entryPoints=[],this.dataDump={rewardsState:{allIds:[],byId:{},rewardStatus:{},status:"DEFAULT"},programsState:{allIds:[],byId:{},status:"DEFAULT",referralLink:"**REFERRAL_LINK**"}},this.entryPointMap={allIds:[],byId:{}},this.afterInitilizeCallBacks=[],window.GLU_SDK_INITILIZED)throw new Error("GLU SDK ALREADY INITILIZED");t&&e&&s&&(this.register(t,e,s),window.GLU_SDK_INITILIZED=!0)}register(t,e,s){if(this.clean(),!t||!e||!s)throw new Error("write Key / user identification / user attribites not passed");e.userId&&function(){if(!localStorage)return;const t=JSON.parse(localStorage.getItem("_GLU_REDIRECT_"));if(!t)return;const e=new Date(t.expiry),s=t.origin;localStorage.removeItem("_GLU_REDIRECT_"),(new Date).valueOf()>e.valueOf()||window.location.href!==s&&(window.location.href=s)}(),this.writeKey=t,this.userIdentification=e,this.userAttributes=s,this.initilize()}clean(){var t;this.entryPointMap&&(null===(t=this.entryPointMap.allIds)||void 0===t?void 0:t.length)&&this.entryPointMap.allIds.forEach((t=>{const e=this.entryPointMap.byId[t];e.isOpen()&&e.close()})),this.afterInitilizeCallBacks=[],this.dataDump={rewardsState:{allIds:[],byId:{},rewardStatus:{},status:"DEFAULT"},programsState:{allIds:[],byId:{},status:"DEFAULT",referralLink:"**REFERRAL_LINK**"}},this.writeKey=null,this.userIdentification=null,this.userAttributes={gluAttributes:{},customAttributes:{}},this.token=null,this.initilized=!1,this.allCampaignsMap={allIds:[],byId:{},defaultUrl:"",base:""},this.entryPoints=[],this.dataDump={rewardsState:{allIds:[],byId:{},rewardStatus:{},status:"DEFAULT"},programsState:{allIds:[],byId:{},status:"DEFAULT",referralLink:"**REFERRAL_LINK**"}},this.entryPointMap={allIds:[],byId:{}}}initilize(){return A(this,void 0,void 0,(function*(){try{const{token:t,allCampaignsMap:e}=yield class{static init(t,e,s){return n=this,o=void 0,h=function*(){try{let n=null,o=Object.assign({},s);e.userId?(n=e.userId,(e.anonymousId||localStorage.getItem("__glu__session"))&&(o=Object.assign(Object.assign({},o),{gluAttributes:Object.assign(Object.assign({},o.gluAttributes),{userState:"loggedIn"})}))):e.anonymousId?(n=e.anonymousId,o=Object.assign(Object.assign({},o),{gluAttributes:Object.assign(Object.assign({},o.gluAttributes),{userState:"nonLoggedIn",anonymousId:e.anonymousId}),customAttributes:Object.assign({},o.customAttributes)})):(n=yield r(void 0,void 0,void 0,(function*(){if(localStorage&&localStorage.getItem("__glu__session"))return localStorage.getItem("__glu__session");try{const t=yield i(`${l}/reward/v1.1/generateSessionId`);return localStorage.setItem("__glu__session",t.parsedBody.sessionId),t.parsedBody.sessionId}catch(t){throw t}})),o=Object.assign(Object.assign({},o),{gluAttributes:Object.assign(Object.assign({},o.gluAttributes),{userState:"nonLoggedIn",anonymousId:n}),customAttributes:Object.assign({},o.customAttributes)}));let a=null;a=e.userToken?e.userToken:yield c(t,n,o);const h=yield d(a),u={base:_(h.defaultUrl),defaultUrl:h.defaultUrl,byId:{},allIds:[]};return h&&h.campaigns&&h.campaigns.forEach((t=>{u.allIds.push(t.campaignId),t.banner=t.banner||{},u.byId[t.campaignId]=t})),{token:a,allCampaignsMap:u}}catch(t){throw t}},new((a=void 0)||(a=Promise))((function(t,e){function s(t){try{r(h.next(t))}catch(t){e(t)}}function i(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(s,i)}r((h=h.apply(n,o||[])).next())}));var n,o,a,h}}.init(this.writeKey,this.userIdentification,this.userAttributes);this.allCampaignsMap=e,this.token=t,window.GluToken=this.token,this.initilized=!0}catch(t){this.afterInitilizeCallBacks&&this.afterInitilizeCallBacks.length&&(this.afterInitilizeCallBacks.forEach((t=>{t.promise&&t.promise.reject("API_ERROR")})),this.afterInitilizeCallBacks=[])}try{this.afterInitilizeCallBacks&&this.afterInitilizeCallBacks.length&&this.afterInitilizeCallBacks.forEach((t=>{t.callback()}))}catch(t){console.log(t)}try{this.entryPoints=yield(t=this.token,r(void 0,void 0,void 0,(function*(){const e=[];try{const s=(yield i("https://api.customerglu.com/entrypoints/v1/list?consumer=WEB",t)).parsedBody;if(s.success&&s.data)return s.data.length&&s.data.forEach((t=>{try{const s=function(t){const e=t.web;if(!e)throw new Error("web entrypoint not found");return{id:t._id,container:o(e.container),content:a(e.content),conditions:t.web.conditions}}(t);e.push(s)}catch(e){console.log("error transforming entry point: ",t._id)}})),e;throw new Error("Entry Points Not Found")}catch(t){throw t}})))}catch(t){console.log("error loading entry point",t)}var t;this.setupEntryPoints(this.entryPoints),this.referesh()}))}setupEntryPoints(t){try{t.forEach((t=>{this.createEntryPoint(t.id,t.content,t.container,t.conditions)}))}catch(t){console.log(t)}}createEntryPoint(t,e,s,n){try{const i={userIdentification:this.userIdentification,allCampaignsMap:this.allCampaignsMap,token:this.token},o=new U({id:t,container:s,content:e,conditions:n},i);return o.addEventListener((e=>this.onSdkEvent(e,t))),o.addCloseEventListener((()=>o.close())),this.entryPointMap.allIds.push(t),this.entryPointMap.byId[t]=o,o}catch(t){throw u({errorName:t&&t.message?t.message:"unknown error",userIdentification:this.userIdentification,userAttributes:this.userAttributes,allCampaignsMap:this.allCampaignsMap,action:{name:"open",container:s,content:e}}),t}}onSdkEvent(t,e){if(!t||"GLU_SDK"!==t.target||!t.action)return;const s=t.action;if("TOGGLE_CONTAINER_CONTENT"===s.type)this.entryPointMap.byId[s.id]?this.entryPointMap.byId[s.id].toggle():this.createEntryPoint(s.id,s.content,s.container).open(),s.data&&(this.dataDump=s.data);else if("CLOSE_CONTAINER_CONTENT"===s.type)this.entryPointMap.byId[e].close(),s.data&&(this.dataDump=s.data);else if("OPEN_CONTAINER_CONTENT"===s.type){const t=f();this.createEntryPoint(t,s.content,s.container).open(),s.data&&(this.dataDump=s.data)}else if("REQUEST_STATE"===s.type)this.entryPointMap.byId[e].sendMessage({type:"UPDATE_CONTENT_STATE",data:this.dataDump});else if("LOGIN"===s.type)!function(t){const e=new Date,s={origin:window.location.href,expiry:new Date(e.setHours(e.getHours()+1))};localStorage&&localStorage.setItem("_GLU_REDIRECT_",JSON.stringify(s)),window.location.href=t}(s.data.url);else if("REDIRECT"===s.type){let t=s.data.url;t=t.includes("?")?t+"&userId="+this.userIdentification.userId:t+"?userId="+this.userIdentification.userId,s.data.openInNewTab?window.open(t):window.location.href=t}else"ANALYTICS"===s.type&&this.analyticsListener&&this.analyticsListener(s.data)}referesh(){const t={};this.entryPointMap.allIds.forEach((e=>{let s=!0;const n=this.entryPointMap.byId[e],i=n.getConditions();let o=null,a=null;i&&(o=i.singleOpenName,a=i.delay),o&&t[o]&&(s=!1),n.checkConditions()||(s=!1),s?(o&&(t[o]=!0),a?setTimeout((()=>{n.open()}),a):n.open()):n.isOpen()&&n.close()}))}open(t,e,s){const n=f();if(!s)return new Promise(((s,i)=>{this.openWithPromise(n,e,t,{resolve:s,reject:i})}));this.openWithPromise(n,e,t,s)}openWithPromise(t,e,s,n){if(this.initilized)try{this.createEntryPoint(t,e,s).open(),n.resolve(t)}catch(t){n.reject(t)}else this.afterInitilizeCallBacks.push({callback:()=>{try{this.createEntryPoint(t,e,s).open(),n.resolve(t)}catch(t){n.reject(t)}},promise:n})}close(t){this.entryPointMap&&this.entryPointMap.byId[t]&&this.entryPointMap.byId[t].close()}addAnalyticsListener(t){this.analyticsListener=t}getCampaignDetails(t,e,s){if(!s)return new Promise(((s,n)=>{this.getCampaignDetailsWithPromise(t,e,{resolve:s,reject:n})}));this.getCampaignDetailsWithPromise(t,e,s)}getCampaignDetailsWithPromise(t,e,s){return A(this,void 0,void 0,(function*(){if(this.initilized)try{const n=yield P(t,e,this.allCampaignsMap);s.resolve(n)}catch(n){s.reject(n),u({errorName:n&&n.message?n.message:"unknown error",userIdentification:this.userIdentification,userAttributes:this.userAttributes,allCampaignsMap:this.allCampaignsMap,action:{name:"getCampaignDetails",filter:t,config:e}})}else this.afterInitilizeCallBacks.push({callback:()=>A(this,void 0,void 0,(function*(){try{const n=yield P(t,e,this.allCampaignsMap);s.resolve(n)}catch(n){s.reject(n),u({errorName:n&&n.message?n.message:"unknown error",userIdentification:this.userIdentification,userAttributes:this.userAttributes,allCampaignsMap:this.allCampaignsMap,action:{name:"getCampaignDetails",filter:t,config:e}})}})),promise:s})}))}}})()})();